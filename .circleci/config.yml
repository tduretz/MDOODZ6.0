version: 2
jobs:
  build:
    working_directory: ~/MDOODZ
    docker:
      - image: cimg/node:14.10.1
        environment:
          HDF5_USE_FILE_LOCKING: FALSE
          C_INCLUDE_PATH: /usr/local/include
          LIBRARY_PATH: /usr/local/lib
    steps:
      - checkout
      - run:
          name: Install and set Linuxbrew
          command: |
            sudo apt-get install build-essential curl file git
            sh -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)"

            echo 'export PATH="/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin/:$PATH"' >> $BASH_ENV
            echo 'export MANPATH="/home/linuxbrew/.linuxbrew/share/man:$MANPATH"' >> $BASH_ENV
            echo 'export INFOPATH="/home/linuxbrew/.linuxbrew/share/info:$INFOPATH"' >> $BASH_ENV
      - run:
          name: install suite-sparse
          command: brew install suite-sparse
      - run:
          name: install hdf5
          command: brew install hdf5
      - run:
          name: install gcc@7
          command: brew install gcc@7
      - run:
          name: prepare makefiile
          command: mv SOURCE/Makefiles/makefile_ubuntu_ci SOURCE/makefile
      - run:
          name: build RiftingPaulineMD6
          command: cd SOURCE/ && make all MODEL=RiftingPaulineMD6 OPT=yes MKL=yes
